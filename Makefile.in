
PREFIX = @prefix@
CXXFLAGS = @CXXFLAGS@
LDFLAGS = @LDFLAGS@

###########

liblacewing.so: Global.o Sync.o SpinSync.o Filter.o Address.o Error.o RelayServer.o \
            Webserver.o Webserver.Incoming.o Webserver.Outgoing.o Webserver.Sessions.o \
            Webserver.Multipart.o Webserver.MimeTypes.o Event.o EventPump.o \
            Server.o Timer.o UDP.o Client.o Pump.o addr_flat.o eventpump_flat.o \
            global_flat.o server_flat.o timer_flat.o webserver_flat.o filter_flat.o \
            udp_flat.o client_flat.o error_flat.o sync_flat.o ssync_flat.o relink

relink:
	g++ $(CXXFLAGS) -shared -o liblacewing.so ./*.o -lpthread -lssl -lrt
	ar rcs liblacewing.a ./*.o && strip --strip-unneeded liblacewing.a
	
Global.o:
	$(CC) $(CXXFLAGS) -c -o Global.o src/Global.cc
Sync.o:
	$(CC) $(CXXFLAGS) -c -o Sync.o src/Sync.cc
SpinSync.o:
	$(CC) $(CXXFLAGS) -c -o SpinSync.o src/SpinSync.cc
Filter.o:
	$(CC) $(CXXFLAGS) -c -o Filter.o src/Filter.cc
Address.o:
	$(CC) $(CXXFLAGS) -c -o Address.o src/Address.cc
Error.o:
	$(CC) $(CXXFLAGS) -c -o Error.o src/Error.cc
RelayServer.o:
	$(CC) $(CXXFLAGS) -c -o RelayServer.o src/RelayServer.cc
Webserver.o:
	$(CC) $(CXXFLAGS) -c -o Webserver.o src/webserver/Webserver.cc
Webserver.Incoming.o:
	$(CC) $(CXXFLAGS) -c -o Webserver.Incoming.o src/webserver/Webserver.Incoming.cc
Webserver.Outgoing.o:
	$(CC) $(CXXFLAGS) -c -o Webserver.Outgoing.o src/webserver/Webserver.Outgoing.cc
Webserver.Sessions.o:
	$(CC) $(CXXFLAGS) -c -o Webserver.Sessions.o src/webserver/Webserver.Sessions.cc
Webserver.Multipart.o:
	$(CC) $(CXXFLAGS) -c -o Webserver.Multipart.o src/webserver/Webserver.Multipart.cc
Webserver.MimeTypes.o:
	$(CC) $(CXXFLAGS) -c -o Webserver.MimeTypes.o src/webserver/Webserver.MimeTypes.cc
Event.o:
	$(CC) $(CXXFLAGS) -c -o Event.o src/unix/Event.cc
EventPump.o:
	$(CC) $(CXXFLAGS) -c -o EventPump.o src/unix/EventPump.cc
Server.o:
	$(CC) $(CXXFLAGS) -c -o Server.o src/unix/Server.cc
Timer.o:
	$(CC) $(CXXFLAGS) -c -o Timer.o src/unix/Timer.cc
UDP.o:
	$(CC) $(CXXFLAGS) -c -o UDP.o src/unix/UDP.cc
Client.o:
	$(CC) $(CXXFLAGS) -c -o Client.o src/unix/Client.cc
Pump.o:
	$(CC) $(CXXFLAGS) -c -o Pump.o src/unix/Pump.cc
addr_flat.o:
	$(CC) $(CXXFLAGS) -c -o addr_flat.o src/c/addr_flat.cc
eventpump_flat.o:
	$(CC) $(CXXFLAGS) -c -o eventpump_flat.o src/c/eventpump_flat.cc
global_flat.o:
	$(CC) $(CXXFLAGS) -c -o global_flat.o src/c/global_flat.cc
server_flat.o:
	$(CC) $(CXXFLAGS) -c -o server_flat.o src/c/server_flat.cc
timer_flat.o:
	$(CC) $(CXXFLAGS) -c -o timer_flat.o src/c/timer_flat.cc
webserver_flat.o:
	$(CC) $(CXXFLAGS) -c -o webserver_flat.o src/c/webserver_flat.cc
filter_flat.o:
	$(CC) $(CXXFLAGS) -c -o filter_flat.o src/c/filter_flat.cc
udp_flat.o:
	$(CC) $(CXXFLAGS) -c -o udp_flat.o src/c/udp_flat.cc
client_flat.o:
	$(CC) $(CXXFLAGS) -c -o client_flat.o src/c/client_flat.cc
error_flat.o:
	$(CC) $(CXXFLAGS) -c -o error_flat.o src/c/error_flat.cc
sync_flat.o:
	$(CC) $(CXXFLAGS) -c -o sync_flat.o src/c/sync_flat.cc
ssync_flat.o:
	$(CC) $(CXXFLAGS) -c -o ssync_flat.o src/c/ssync_flat.cc

############
    
all: liblacewing.so

clean:
	rm -f liblacewing.so liblacewing.a *.o

install: liblacewing.so liblacewing.a
	install -m 0755 liblacewing.so $(PREFIX)/lib
	install -m 0644 ./include/Lacewing.h $(PREFIX)/include/Lacewing.h
	install -m 0755 liblacewing.a $(PREFIX)/lib

.PHONY: all clean install

